# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Особенности архитектуры

Было решено реализовать три слоя:

- `Model` - слой работы с данными
- `View` - слой отображения
- `Controller` - слой управления

UML-диаграмма:
!!!!!!!!!!!!!вставить диаграмму

## Базовые компоненты

#### Класс `Api`

Класс `Api` является базовым классом для работы с API. С его помощью отправляются `GET` и `POST` запросы к бэкенду проекта.

**Поля**
- `baseUrl: string` - базовый URL для запросов
- `options: RequestInit` - объект опций для запросов

**Конструктор**
Конструктор класса принимает в качестве аргументов базовый URL для API и объект опций для запросов.

**Методы**
- `handleResponse(response: Response): Promise<object>` - защищенный метод принимает и обрабатывает ответ сервера
- `get(uri: string)` - публичный метод метод принимает URI отправляет `GET` запрос к указанному адресу, ответ запроса обрабатывается при помощи метода `handleResponse` и возвращается `Promise`
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - публичный метод принимает URI и данные, которые необходимо отдать на сервер; ответ запроса обрабатывается при помощи метода `handleResponse` и возвращается `Promise`

**Типы и интерфейсы**
- `type ApiListResponse<Type>` - типизация ответа от сервера. Содержит общее число элементов, полученных с бэкенда, а также массив этих элементов заданного типа.
- `type ApiPostMethods` - типизация методов `POST` запросов

#### Класс `EventEmitter`

Класс имплементирует интерфейс `IEvents` и представляет собой классическую реализацию брокера событий, выступающего в роли контроллера - связующего звена между моделью и отображением.

**Поля**
- `_events: Map<EventName, Set<Subscriber>>` - приватное свойство, содержащее карту "вид события - набор подписчиков"

**Конструктор**
В конструкторе инициализируется свойство `_events` пустой мапой. При вызове свойств туда будут записываться новые события и подписчики на них.

**Методы**
- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - публичный метод принимает название события и коллбэк, позволяет подписаться на событие
- `off(eventName: EventName, callback: Subscriber)` - публичный метод принимает название события и коллбэк, позволяет снять обработчик с события
- `emit<T extends object>(eventName: string, data?: T)` - публичный метод принимает название события и опциональные данные, позволяет инициировать событие с данными
- `onAll(callback: (event: EmitterEvent) => void)` - публичный метод принимает коллбэк, позволяет подписаться на все события
- `offAll()` - публичный метод позволяет снять обработчики со всех событий
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - публичный метод принимает название события и опционально контекст, позволяет создать триггер и инициировать событие

**Типы и интерфейсы**
- `type EventName` - типизация имени события строкой или регулярным выражением
- `type Subscriber` - типизация функции-подписчика на событие
- `type EmitterEvent` - типизация события эмиттера с именем и данными
- `interface IEvents` - интерфейс, необходимый для реализации принципа инверсии зависимостей

#### Класс `Component`

Абстрактный класс базового отображения. Обеспечивает базовый функционал работы с DOM-элементами.

**Поля**
- `container` - контейнер, в который помещается компонент интерфейса

**Конструктор**
В конструкторе принимается в качестве аргумента DOM-элемент контейнера, который он сохраняет в защищенном свойстве.

**Методы**
- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - публичный метод, позволяющий переключить класс элемента
- `setText(element: HTMLElement, value: unknown)` - защищенный метод, позволяющий установить текстовое содержимое элемента
- `setDisabled(element: HTMLElement, state: boolean)` - защищенный метод, позволяющий сменить статус блокировки элемента
- `setHidden(element: HTMLElement)` - защищенный метод, позволяющий визуально скрыть элемент
- `setVisible(element: HTMLElement)` - защищенный метод, позволяющий визуально отобразить элемент
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - защищенный метод, позволяющий установить изображение и альтернативный текст
- `render(data?: Partial<T>): HTMLElement` - публичный метод рендера, возвращающий корневой DOM-элемент

#### Класс `Model`

Абстрактный класс базовой модели.

**Поля**
- `events: IEvents` - защищенное свойство, хранящее события

**Конструктор**
Переданные в конструктор данные копируются в инстансы класса. Таким образом, для дочерних классов нет необходимости переопределять конструктор.

**Методы**
- `emitChanges(event: string, payload?: object)` - публичный метод, позволяющий сообщить подписчикам о изменении модели

## Модели данных

Было решено реализовать 4 сущности:

- Модель продукта - `Product`
- Модель каталога товаров - `Catalog`
- Модель корзины - `Basket`
- Модель данных заказа - `Order`

#### Класс `Product`

Наследует абстрактный класс Model, на место дженерика передается интерфейс `IProduct`. Хранит данные о товаре.

**Поля**
Все свойства являются публичными.

- `id: string` - уникальный идентификатор товара
- `description: string` - описание товара
- `image: string` - картинка товара
- `title: string` - название товара
- `category: CategoryType` - категория товара
- `price: number | null` - цена товара
- `inBasket: boolean` - показывает, находится ли товар в корзине

**Методы**
Поскольку данные о товаре не меняются, методов данный класс не предусматривает.

**Типы и интерфейсы**
- `type CategoryType` - список доступных категорий товаров
- `interface IProduct` - описывает данные о товаре, прилетающие с бэка, содержит те же поля, что класс `Product`

#### Класс `Catalog`

Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IProduct`. Хранит данные о всех товарах.

**Поля**
- `products: IProduct[]` - публичное свойство, хранящее массив товаров

**Методы**
- `setProducts(items: IProduct[])` - публичный метод, позволяющий из переданных данных создать инстансы класса `Product` и сохранить в свойство `products`. Также уведомляет подписчиков об изменении модели родительским методом `emitChanges`.

#### Класс `BasketModel`

Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IBasket`. Хранит данные о добавленных пользователем в корзину товарах.

**Поля**
- `products: IProduct[] = []` - публичное свойство, хранящее массив товаров
- `total: number | null` - публичное свойство, хранящее сумму к оплате

**Методы**
- `addToBasket(product: IProduct)` - публичный метод, позволяющий добавить товар в корзину
- `removeFromBasket(product: IProduct)` - публичный метод, позволяющий удалить товар из корзины
- `clearBasket()` - публичный метод, позволяющий очистить корзину
- `getTotalBasketPrice()` - приватный метод, позволяющий получить суммарную стоимость товаров в корзине

## Отображение

#### Класс `Page`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IPage`. Это класс отображения всей страницы, содержащей хедер с логотипом и корзиной, а также каталог товаров.

**Поля**
Защищенные поля:
- `_counter: HTMLElement` - DOM-элемент, в котором будет отображаться количество товаров в корзине
- `_catalog: HTMLElement` - DOM-элемент для отображения каталога товаров
- `_wrapper: HTMLElement` - DOM-элемент, являющийся оболочкой страницы; необходим, чтобы заблокировать прокрутку страницы
- `_basket: HTMLElement` - DOM-элемент для отображения корзины

**Конструктор**
В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляется слушатель на клик по корзине.

**Методы**
Из методов на странице есть следующие сеттеры:
- `set counter(value: number)` - устанавливает количество товаров в корзине
- `set catalog(items: HTMLElement[])` - устанавливает товары в каталог
- `set locked(value: boolean)` - позволяет заблокировать страницу для прокрутки

**Типы и интерфейсы**
- `interface IPage` - содержит те публичные свойства класса, которые можно установить сеттерами

#### Класс `Card`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IProduct`. Это класс отображения карточки. Было решено сделать один класс, содержащий все поля карточки, а потом сетать его в разные темплейты (отображение в каталоге, отображение на превью)

**Поля**
Защищенные поля:
- `_title: HTMLElement` - DOM-элемент для отображения названия товара
- `_category: HTMLElement` - DOM-элемент для отображения категории товара
- `_image: HTMLImageElement` - DOM-элемент для отображения картинки
- `_price: HTMLElement` - DOM-элемент для отображения цены
- `_description: HTMLElement` - DOM-элемент для отображения описания товара
- `_button: HTMLButtonElement` - DOM-элемент для отображения кнопки "В коризну"
- `_basketIndex: HTMLElement` - DOM-элемент для отображения индекса карточки, находящейся в корзине
- `_deleteFromBasketButton: HTMLButtonElement` - DOM-элемент для отображения иконки удаления товара из корзины

**Конструктор**
В качестве аргументов принимает название блока (чтобы сформировать селектор для поиска элементов по DOM-дереву), контейнер для поиска и опционально объект действий. В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляются слушатели на клики.

**Методы**
Релизованы следующие геттеры и сеттеры:

- `set id(value: string)` и `get id(): string` - позволяют установить и получить id товара
- `set title(value: string)` и `get title(): string` - позволяют установить и получить название товара
- `set image(value: string)` - позволяет установить изображение товара
- `set price(value: number | null)` - позволяет установить цену товара; также форматирует цену, чтобы числа выглядели, как в макете, при помощи функции `handlePrice()`. В этом сеттере дополнительно реализована блокировка кнопки добавления в корзину для бесценного товара.
- `set category(value: CategoryType)` - позволяет установить категорию товара; также добавляет DOM-элементу селектор соответствующей категории, чтобы отобразить цвет тега
- `set description(value: string)` - устанавливает описание товара
- `set basketIndex(value: number)` - устанавливает номер по порядку для товаров в корзине

Также реализован публичный метод:

- `switchButtonText` - метод для смены текста кнопки после добавления/удаления товара из корзины

**Типы и интерфейсы**
- `interface ICardActions` - типизирует действия с карточкой методом `onClick`

#### Класс `Modal`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IModalData`. Это класс отображения модального окна. В него будет сетаться различный контент: карточка товара, корзина, окно успешного оформления и т.д.

**Поля**
Защищенные поля:
- `_closeButton: HTMLButtonElement` - DOM-элемент кнопки закрытия модального окна
- `_content: HTMLElement` - DOM-элемент для отображения контента

**Конструктор**
В качестве аргументов принимает контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также доабвляются слушатели на клики.

**Методы**
- `set content(value: HTMLElement)` - сеттер для установки контента в модалку
- `open()` - публичный метод для открытия модалки
- `close()` - публичный метод для закрытия модалки
- `render()` - публичный метод для отрисовки модалки

**Типы и интерфейсы**
- `interface IModalData` - интерфейс, описывающий структуру данных, которые необходимо передать модалке для отрисовки

#### Класс `Basket`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IBasket`. Это класс отображения корзины. Корзина будет рендериться в модальном окне. В свою очередь, в корзине будут рендериться карточки выбранных товаров.

**Поля**
Защищенные поля:
- `_list: HTMLElement` - DOM-элемент для отображения списка товаров
- `_total: HTMLElement` - DOM-элемент для отображения итоговой суммы корзины
- `_button: HTMLButtonElement` - DOM-элемент для отображения кнопки "Оформить"

**Конструктор**
В качестве аргументов принимает название блока, контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на клик по кнопке офорления заказа.

**Методы**
Реализованы следующие сеттеры:
- `set total(price: number)` - сеттер для установки стоимости товаров в корзине
- `set items(items: HTMLElement[])` - для установки отображаемых в корзине товаров; здесь же в зависимости от наличия товаров в корзине активируется/деактивируется кнопка оформления заказа

**Типы и интерфейсы**
- `interface IModalData` - интерфейс, описывающий структуру данных, которые необходимо передать модалке для отрисовки
